<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Receipt Generator — BelantikMaya (A5)</title>
  <style>
    :root{
      --brand-dark:#1f4d45;
      --accent:#ff8c42;
      --muted:#f5f5f5;
      --text:#111;
      --paper-w:148mm;
      --paper-h:210mm;
      --logo-size:88px;
      --gap:12px;
    }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif;color:var(--text);background:#faf9f6}
    .app{display:flex;gap:var(--gap);padding:12px;box-sizing:border-box;min-height:100vh}
    .col{flex:1 1 0;min-width:300px;background:#fff;padding:14px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.06);box-sizing:border-box}
    label{display:block;font-size:13px;margin-top:12px;color:#333}
    input[type=text], input[type=number], textarea, select, input[type=date]{width:100%;padding:8px 10px;border:1px solid #e6e6e6;border-radius:6px;margin-top:6px;box-sizing:border-box}
    .row{display:flex;gap:10px}
    .row .col-inner{flex:1}
    button{background:var(--brand-dark);color:#fff;border:none;padding:10px 12px;border-radius:6px;cursor:pointer}
    button.secondary{background:#666}
    .actions{display:flex;gap:8px;margin-top:12px}
    .preview-viewport{width:100%;height:100%;display:flex;justify-content:center;align-items:flex-start}
    .receipt{width:100%;max-width:520px;background:#fff;padding:16px;box-sizing:border-box;position:relative;border:1px solid #eee}
    .receipt.print-size{width:var(--paper-w);height:var(--paper-h);padding:12mm}
    .header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
    .company{display:flex;gap:12px;align-items:center}
    .logo{width:var(--logo-size);height:var(--logo-size);object-fit:contain}
    .company-info{font-size:13px}
    .company-info .biz{font-weight:700;color:var(--brand-dark);font-size:16px}
    .meta{font-size:13px;text-align:right}
    .meta div{color:#444}
    .cust-inv{display:flex;justify-content:space-between;gap:12px;margin-top:12px}
    .cust{flex:1}
    .inv{flex:1;text-align:right}
    .cust .label{font-weight:700;margin-bottom:6px}
    table.items{width:100%;border-collapse:collapse;margin-top:12px}
    table.items th, table.items td{padding:8px;border-bottom:1px dashed #ddd;font-size:13px}
    table.items th{text-align:left}
    table.items td.numeric{text-align:right}
    .totals{margin-top:8px;display:flex;justify-content:flex-end}
    .totals table{width:320px;border-collapse:collapse}
    .totals td{padding:6px;font-size:13px}
    .totals .label{text-align:left}
    .totals .val{text-align:right}
    .totals .subtotal{font-weight:600}
    .totals .discount{font-weight:600}
    .totals .grand{font-weight:900;font-size:15px}
    .foot{margin-top:12px;font-size:12px;color:#555}

    /* print: hide everything except receipt and force A5 size */
    @media print{
      body *{visibility:hidden}
      #receipt, #receipt *{visibility:visible}
      #receipt{position:fixed;left:0;top:0;width:148mm;height:210mm;margin:0;padding:12mm;box-sizing:border-box}
      @page { size: 148mm 210mm; margin:0; }
    }

    @media(max-width:900px){
      .app{flex-direction:column}
      .header{flex-direction:column;align-items:flex-start}
      .meta{text-align:left;margin-top:8px}
      .cust-inv{flex-direction:column}
      .inv{text-align:left}
      .receipt{max-width:100%;padding:12px}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="col" id="formCol">
      <h3>Konfigurasi Resit — BelantikMaya</h3>

      <label>Nama Perniagaan</label>
      <input id="bizName" type="text" value="BelantikMaya" />

      <label>Website</label>
      <input id="bizWebsite" type="text" value="https://belantikmaya.netlify.app" />

      <label>Email Perniagaan</label>
      <input id="bizEmail" type="text" value="info@belantikmaya.my" />

      <label>Alamat</label>
      <textarea id="bizAddr" rows="2">Petaling Jaya, Selangor</textarea>

      <div class="row">
        <div class="col-inner">
          <label>No. Telefon</label>
          <input id="bizPhone" type="text" value="012-3456789" />
        </div>
        <div class="col-inner">
          <label>No. Resit / Invois (Opsyenal)</label>
          <input id="invNo" type="text" placeholder="Kosong untuk auto" />
        </div>
      </div>

      <hr style="margin:12px 0;border-top:1px solid #eee" />

      <div class="row">
        <div class="col-inner">
          <label>Nama Pelanggan</label>
          <input id="custName" type="text" />
        </div>
        <div class="col-inner">
          <label>Email Pelanggan (opsyenal)</label>
          <input id="custEmail" type="text" />
        </div>
      </div>

      <div class="row">
        <div class="col-inner">
          <label>Telefon Pelanggan (opsyenal)</label>
          <input id="custPhone" type="text" />
        </div>
        <div class="col-inner">
          <label>Tarikh Resit</label>
          <input id="date" type="date" value="2025-10-27" />
        </div>
      </div>

      <label>Kaedah Bayaran</label>
      <select id="payMethod"><option>Tunai</option><option>Bank Transfer</option><option>Online</option></select>

      <hr style="margin:12px 0;border-top:1px solid #eee" />

      <h4>Item</h4>
      <table id="itemsTable" style="width:100%;border-collapse:collapse">
        <thead>
          <tr><th style="text-align:left">Deskripsi</th><th style="width:70px">Qty</th><th style="width:120px">Harga (RM)</th><th style="width:100px">Jumlah</th><th style="width:40px"></th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="addRow">Tambah Baris</button>
        <button class="secondary" id="resetRows">Reset</button>
      </div>

      <hr style="margin:12px 0;border-top:1px solid #eee" />

      <label>Diskaun</label>
      <div class="row">
        <div class="col-inner">
          <select id="discountType"><option value="none">Tiada</option><option value="percent">Peratus (%)</option><option value="amount">Jumlah (RM)</option></select>
        </div>
        <div class="col-inner">
          <input id="discountValue" type="number" min="0" step="0.01" placeholder="0" />
        </div>
      </div>

      <div class="actions">
        <button id="updatePreview">Kemas kini Preview</button>
        <button id="printBtn" style="background:var(--accent)">Cetak Resit</button>
      </div>

    </div>

    <div class="col" id="previewCol">
      <div class="preview-viewport">
        <div id="receipt" class="receipt" role="document">
          <div class="header">
            <div class="company">
              <img src="logo.webp" class="logo" id="logoImg" alt="logo" onerror="this.style.display='none'" />
              <div class="company-info">
                <div class="biz" id="rBizName">BelantikMaya</div>
                <div class="muted" id="rBizAddr">Petaling Jaya, Selangor</div>
                <div class="muted" id="rBizPhone">012-3456789</div>
                <div class="muted" id="rBizWebsite">https://belantikmaya.netlify.app</div>
                <div class="muted" id="rBizEmail">info@belantikmaya.my</div>
              </div>
            </div>

            <div class="meta">
              <div>No: <span id="rInv">INV-2025-001</span></div>
              <div>Tarikh: <span id="rDate">27 Okt 2025</span></div>
              <div>Kaedah: <span id="rPay">Tunai</span></div>
            </div>
          </div>

          <div class="cust-inv">
            <div class="cust">
              <div class="label">BIL KEPADA / CUSTOMER</div>
              <div id="rCustName">-</div>
              <div id="rCustEmail"></div>
              <div id="rCustPhone"></div>
            </div>
            <div class="inv"></div>
          </div>

          <table class="items" id="rItems">
            <thead><tr><th>Perkara</th><th style="text-align:right">Qty</th><th style="text-align:right">Harga</th><th style="text-align:right">Jumlah</th></tr></thead>
            <tbody></tbody>
            <tfoot>
              <tr><td colspan="2"></td><td style="text-align:right" class="subtotal">Subtotal</td><td style="text-align:right" id="rSubtotal">0.00</td></tr>
              <tr><td colspan="2"></td><td style="text-align:right" class="discount">Diskaun</td><td style="text-align:right" id="rDiscount">0.00</td></tr>
              <tr><td colspan="2"></td><td style="text-align:right" class="grand">Jumlah</td><td style="text-align:right" id="rTotal">0.00</td></tr>
            </tfoot>
          </table>

          <div class="foot">Terima kasih kerana memilih BelantikMaya. Semua jualan tertakluk kepada terma & syarat.</div>
        </div>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  function to2(v) { return Number(v || 0).toFixed(2); }
  function escapeHtml(s) { return (s || '').toString().replace(/[&<>"]/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]; }); }

  var itemsBody = document.querySelector('#itemsTable tbody');

  function addItemRow(desc, qty, price) {
    desc = desc || '';
    qty = (typeof qty === 'number') ? qty : 1;
    price = (typeof price === 'number') ? price : 0;
    var tr = document.createElement('tr');

    tr.innerHTML = ''
      + '<td><input class="itm-desc" type="text" value="' + escapeHtml(desc) + '"></td>'
      + '<td><input class="itm-qty" type="number" min="1" value="' + qty + '"></td>'
      + '<td><input class="itm-price" type="number" min="0" step="0.01" value="' + price + '"></td>'
      + '<td class="itm-sum">' + to2(qty * price) + '</td>'
      + '<td><button type="button" class="del">-</button></td>';

    itemsBody.appendChild(tr);

    var descEl = tr.querySelector('.itm-desc');
    var qtyEl = tr.querySelector('.itm-qty');
    var priceEl = tr.querySelector('.itm-price');
    var delBtn = tr.querySelector('.del');

    function onRowChange() {
      var q = Number(qtyEl.value || 0);
      var p = Number(priceEl.value || 0);
      var sum = q * p;
      var sumEl = tr.querySelector('.itm-sum');
      if (sumEl) sumEl.textContent = to2(sum);
      updatePreview();
    }

    descEl.addEventListener('input', updatePreview);
    qtyEl.addEventListener('input', onRowChange);
    priceEl.addEventListener('input', onRowChange);
    delBtn.addEventListener('click', function () { tr.parentNode.removeChild(tr); updatePreview(); });
  }

  function seedRows() {
    if (document.querySelectorAll('#itemsTable tbody tr').length === 0) {
      addItemRow('Magnetic Insect Screen', 1, 50);
      addItemRow('Installation', 1, 30);
    }
  }

  function formatDateToMalay(dstr) {
    if (!dstr) return '';
    var dt = new Date(dstr);
    if (isNaN(dt.getTime())) return dstr;
    return dt.toLocaleDateString('ms-MY', { day: '2-digit', month: 'short', year: 'numeric' });
  }

  function updatePreview() {
    var bizName = (document.getElementById('bizName') || {}).value || 'BelantikMaya';
    var bizAddr = (document.getElementById('bizAddr') || {}).value || '';
    var bizPhone = (document.getElementById('bizPhone') || {}).value || '';
    var bizWebsite = (document.getElementById('bizWebsite') || {}).value || '';
    var bizEmail = (document.getElementById('bizEmail') || {}).value || '';

    document.getElementById('rBizName').textContent = bizName;
    document.getElementById('rBizAddr').textContent = bizAddr;
    document.getElementById('rBizPhone').textContent = bizPhone;
    document.getElementById('rBizWebsite').textContent = bizWebsite;
    document.getElementById('rBizEmail').textContent = bizEmail;

    var invField = (document.getElementById('invNo') || {}).value || '';
    var invNo = invField.trim() || ('INV-' + new Date().toISOString().slice(0,10).replace(/-/g,'') + '-' + String(Math.floor(Math.random() * 900 + 100)));
    document.getElementById('rInv').textContent = invNo;

    var dateVal = (document.getElementById('date') || {}).value || new Date().toISOString().slice(0,10);
    document.getElementById('rDate').textContent = formatDateToMalay(dateVal);

    var pay = (document.getElementById('payMethod') || {}).value || '';
    document.getElementById('rPay').textContent = pay;

    var cName = (document.getElementById('custName') || {}).value || '';
    var cEmail = (document.getElementById('custEmail') || {}).value || '';
    var cPhone = (document.getElementById('custPhone') || {}).value || '';
    document.getElementById('rCustName').textContent = cName || '-';
    document.getElementById('rCustEmail').textContent = cEmail ? ('Email: ' + cEmail) : '';
    document.getElementById('rCustPhone').textContent = cPhone ? ('Tel: ' + cPhone) : '';

    // build items table in preview
    var tbody = document.querySelector('#rItems tbody');
    tbody.innerHTML = '';
    var subtotal = 0;
    var rows = document.querySelectorAll('#itemsTable tbody tr');
    for (var i = 0; i < rows.length; i++) {
      var r = rows[i];
      var d = (r.querySelector('.itm-desc') || {}).value || '';
      var q = Number((r.querySelector('.itm-qty') || {}).value || 0);
      var p = Number((r.querySelector('.itm-price') || {}).value || 0);
      var s = q * p;
      subtotal += s;
      var tr = document.createElement('tr');
      tr.innerHTML = '<td>' + escapeHtml(d) + '</td><td class="numeric">' + q + '</td><td class="numeric">' + to2(p) + '</td><td class="numeric">' + to2(s) + '</td>';
      tbody.appendChild(tr);
    }

    // discount
    var discType = (document.getElementById('discountType') || {}).value || 'none';
    var discVal = Number((document.getElementById('discountValue') || {}).value || 0);
    var discAmt = 0;
    if (discType === 'percent') {
      discAmt = subtotal * (discVal / 100);
    } else if (discType === 'amount') {
      discAmt = discVal;
    }
    if (discAmt < 0) discAmt = 0;
    if (discAmt > subtotal) discAmt = subtotal;

    var total = subtotal - discAmt;
    document.getElementById('rSubtotal').textContent = to2(subtotal);
    document.getElementById('rDiscount').textContent = discAmt ? ('-' + to2(discAmt)) : '0.00';
    document.getElementById('rTotal').textContent = to2(total);
  }

  function bindLiveInputs() {
    var liveIds = ['bizName','bizAddr','bizPhone','bizWebsite','bizEmail','custName','custEmail','custPhone','invNo','date','payMethod','discountType','discountValue'];
    for (var i = 0; i < liveIds.length; i++) {
      var el = document.getElementById(liveIds[i]);
      if (el) el.addEventListener('input', updatePreview);
    }
    var btnPreview = document.getElementById('updatePreview');
    if (btnPreview) btnPreview.addEventListener('click', updatePreview);

    var btnPrint = document.getElementById('printBtn');
    if (btnPrint) btnPrint.addEventListener('click', function () {
      updatePreview();
      // small delay to ensure DOM repaint
      setTimeout(function () { window.print(); }, 120);
    });

    var addBtn = document.getElementById('addRow');
    if (addBtn) addBtn.addEventListener('click', function () { addItemRow('Perkara',1,0); });

    var resetBtn = document.getElementById('resetRows');
    if (resetBtn) resetBtn.addEventListener('click', function () { itemsBody.innerHTML = ''; updatePreview(); });
  }

  // initialize
  seedRows();
  bindLiveInputs();
  updatePreview();
});
</script>
</body>
</html>
